server:
  port: 9999 # Test


spring:

  application:
    name: test

  profiles:
    active: dev

  main:
    allow-circular-references: true # 允许循环引用
    allow-bean-definition-overriding: true # 允许覆盖bean定义
    lazy-initialization: false # 关闭懒加载, 防止组件失效

  # MySQL
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: ${infrastructure.datasource.driver-class-name}
    url: jdbc:mysql://${infrastructure.datasource.host}:${infrastructure.datasource.port}/${infrastructure.datasource.database}?serverTimezone=Asia/Shanghai&useUnicode=true&characterEncoding=utf-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true
    username: ${infrastructure.datasource.username}
    password: ${infrastructure.datasource.password}


    # druid
    druid:
      initial-size: 10
      min-idle: 5
      max-active: 50
      max-wait: 60000
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000
      validation-query: SELECT 1
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      pool-prepared-statements: true
      max-pool-prepared-statement-per-connection-size: 20
      filters: stat,wall,log4j
      connection-properties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000


  # Redis
  data:
    redis:
      host: ${infrastructure.redis.host}
      port: ${infrastructure.redis.port}
      password: ${infrastructure.redis.password}
      database: ${infrastructure.redis.database}
      lettuce:
        pool:
          max-active: 10
          max-idle: 10
          min-idle: 1
          time-between-eviction-runs: 10s
      timeout: 10000

  # RabbitMQ
  rabbitmq:
    host: ${infrastructure.rabbitmq.host}
    username: ${infrastructure.rabbitmq.username}
    password: ${infrastructure.rabbitmq.password}
    virtual-host: ${infrastructure.rabbitmq.virtual-host}
    port: ${infrastructure.rabbitmq.port}

    listener:
      simple:
        concurrency: 10
        max-concurrency: 10
        prefetch: 1
        auto-startup: true
        default-requeue-rejected: true

    template:
      retry:
        enabled: true
        initial-interval: 1000ms
        max-attempts: 3
        max-interval: 10000ms
        multiplier: 1

  # Nacos
  cloud:
    nacos:
      discovery:
        server-addr: ${infrastructure.nacos.host}:${infrastructure.nacos.port} # nacos发现地址
      config:
        server-addr: ${infrastructure.nacos.host}:${infrastructure.nacos.port} # nacos配置中心地址

    sentinel:
      enabled: true # 是否开启。默认为 true 开启
      eager: true # 是否饥饿加载。默认为 false 关闭
      transport:
        port: 9993
        dashboard: ${infrastructure.sentinel.host}:${infrastructure.sentinel.port} # Sentinel 控制台地址
        clientIp: 127.0.0.1



  #文件上传
  servlet:
    multipart:
      max-file-size: 500MB
      max-request-size: 500MB
      enabled: true


  #时间格式
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8
    default-property-inclusion: non_null # JSON处理时忽略空字段


mybatis-plus:
  # todo
  mapper-locations: classpath*:src/main/java/xyz/spc/infra/mapper/Guest/mapper/*Mapper.xml  # MyBatis Mapper所对应的XML文件位置

  global-config:
    banner: false

    db-config:
      # 主键类型 0:数据库ID自增 1.未定义 2.用户输入 3 id_worker 4.uuid 5.id_worker字符串表示
      # 手动实现雪花算法的主键生成策略
      id-type: INPUT
      table-underline: true # 默认数据库表下划线命名

mybatis-plus-join:
  banner: false

# 日志配置
logging:

  level:
    xyz.spc:
      DEBUG # todo 暂时全开

  pattern:
    dateformat: mm:ss.SSS



# 关闭心跳监控
management:
  health:
    redis:
      enabled: false
    rabbit:
      enabled: false


# springdoc
springdoc:

  swagger-ui:
    path: doc.html

